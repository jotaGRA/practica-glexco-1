name: ğŸ“ Ejemplo BÃ¡sico de Jobs y Steps (CORREGIDO)

on:
  workflow_dispatch:

jobs:
  preparacion:
    name: ğŸ“¦ Preparar ambiente
    runs-on: ubuntu-latest
    
    steps:
      - name: Descargar cÃ³digo del repositorio
        uses: actions/checkout@v4
      
      - name: Crear archivo de configuraciÃ³n
        run: |
          echo "PROYECTO=MiProyecto" > config.txt
          echo "VERSION=1.0.0" >> config.txt
          echo "FECHA=$(date)" >> config.txt
          echo "âœ… Archivo config.txt creado"
          ls -la
      
      # GUARDAR el archivo como artifact
      - name: Guardar archivo para siguiente job
        uses: actions/upload-artifact@v4
        with:
          name: configuracion
          path: config.txt
      
      - name: Generar salida (output)
        run: |
          echo "nombre=mi-aplicacion" >> $GITHUB_OUTPUT
          echo "estado=preparado" >> $GITHUB_OUTPUT
      
      - name: Mostrar detalles del runner
        run: |
          echo "ğŸƒ Runner: ${{ runner.os }}"
          echo "ğŸ“ Directorio: ${{ runner.workspace }}"
          echo "ğŸ”§ GitHub SHA: ${{ github.sha }}"

  pruebas:
    name: ğŸ§ª Ejecutar pruebas
    runs-on: ubuntu-latest
    needs: preparacion
    
    steps:
      # DESCARGAR el artifact del job anterior
      - name: Descargar archivo de configuraciÃ³n
        uses: actions/download-artifact@v4
        with:
          name: configuracion
      
      - name: Leer archivo creado
        run: |
          echo "ğŸ“– Contenido de config.txt:"
          cat config.txt
          
          if [ ! -f "config.txt" ]; then
            echo "âŒ ERROR: No se encontrÃ³ config.txt"
            exit 1
          fi
      
      - name: Ejecutar pruebas simples
        run: |
          echo "ğŸ§ª Ejecutando pruebas..."
          echo "1. Prueba de conexiÃ³n... âœ…"
          echo "2. ValidaciÃ³n de datos... âœ…"
          echo "3. Prueba de rendimiento... âœ…"
          echo "ğŸ‰ Â¡Todas las pruebas pasaron!"
      
      - name: Prueba condicional (puede fallar)
        id: prueba-condicional
        continue-on-error: true
        run: |
          echo "ğŸ” Ejecutando prueba opcional..."
          if [ $((RANDOM % 3)) -eq 0 ]; then
            echo "âš ï¸ Esta prueba fallÃ³ (simulado)"
            exit 1
          else
            echo "âœ… Prueba opcional exitosa"
          fi
      
      - name: Mostrar resultado de pruebas
        run: |
          echo "ğŸ“Š Resultado: ${{ steps.prueba-condicional.outcome }}"
          if [ "${{ steps.prueba-condicional.outcome }}" = "failure" ]; then
            echo "âš ï¸ Una prueba fallÃ³, pero el job continÃºa"
          fi

  resumen:
    name: ğŸ“‹ Mostrar resumen
    runs-on: ubuntu-latest
    needs: [preparacion, pruebas]
    if: always()
    
    steps:
      - name: Recolectar resultados
        run: |
          echo "ğŸ“Š RESUMEN DEL WORKFLOW"
          echo "========================"
          echo "ğŸ“¦ PreparaciÃ³n: ${{ needs.preparacion.result }}"
          echo "ğŸ§ª Pruebas: ${{ needs.pruebas.result }}"
          echo "â° Hora: $(date)"
          echo "ğŸ‘¤ Ejecutado por: ${{ github.actor }}"
          
          if [[ "${{ needs.pruebas.result }}" == "success" ]]; then
            echo "ğŸ‰ Â¡Todos los jobs principales fueron exitosos!"
          else
            echo "âš ï¸ Algunos jobs tuvieron problemas"
          fi
      
      - name: Mensaje de Ã©xito
        if: success()
        run: echo "âœ… Â¡Workflow completado exitosamente!"
      
      - name: Mensaje de advertencia
        if: failure()
        run: echo "âš ï¸ El workflow completÃ³ con algunos errores"
      
      - name: Limpieza final
        run: echo "ğŸ§¹ Finalizando ejecuciÃ³n..."