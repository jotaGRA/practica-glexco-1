name: ğŸ“ Ejemplo Simple - Condicionales, Matriz, Dependencias

on:
  workflow_dispatch:  # Solo ejecuciÃ³n manual para la clase

jobs:
  # JOB 1: Construir con mÃºltiples versiones (MATRIZ)
  construir:
    name: ğŸ—ï¸ Construir
    runs-on: ubuntu-latest
    
    # MATRIZ: Ejecuta este job 3 veces con diferentes versiones
    strategy:
      matrix:
        node-version: [14, 16, 18]  # 3 versiones diferentes
    
    steps:
      - name: Mostrar versiÃ³n de Node.js
        run: |
          echo "ğŸ”§ Usando Node.js ${{ matrix.node-version }}"
          echo "Este job se ejecuta 3 veces, una por cada versiÃ³n"
      
      - name: Paso solo para Node 18
        if: matrix.node-version == 18  # CONDICIONAL
        run: echo "ğŸš€ Esta es la versiÃ³n mÃ¡s reciente de Node"
      
      - name: Paso solo para versiones viejas
        if: matrix.node-version < 16  # CONDICIONAL
        run: echo "âš ï¸  VersiÃ³n antigua de Node - considerar actualizar"

  # JOB 2: Probar (DEPENDE de construir)
  probar:
    name: ğŸ§ª Probar
    runs-on: ubuntu-latest
    needs: construir  # DEPENDENCIA: Espera a que 'construir' termine
    
    steps:
      - name: Ejecutar pruebas
        run: |
          echo "ğŸ§ª Ejecutando pruebas..."
          echo "Este job SOLO comienza despuÃ©s de que 'construir' termine"
          echo "EsperÃ³ 3 ejecuciones (una por cada versiÃ³n de Node)"
      
      - name: Paso condicional
        # CONDICIONAL en step
        if: ${{ success() }}  # Solo si el paso anterior fue exitoso
        run: echo "âœ… Todas las pruebas pasaron"

  # JOB 3: Desplegar (condicional por rama)
  desplegar:
    name: ğŸš€ Desplegar
    runs-on: ubuntu-latest
    needs: probar  # DEPENDENCIA: Espera a que 'probar' termine
    
    # CONDICIONAL en job completo
    if: github.ref == 'refs/heads/main'  # Solo en rama main
    
    steps:
      - name: Desplegar aplicaciÃ³n
        run: |
          echo "ğŸš€ Desplegando a producciÃ³n..."
          echo "Este job solo se ejecuta si:"
          echo "1. Estamos en la rama main"
          echo "2. El job 'probar' terminÃ³ exitosamente"
          echo "3. El job 'construir' terminÃ³ exitosamente"

  # JOB 4: Notificar (SIEMPRE se ejecuta)
  notificar:
    name: ğŸ“¢ Notificar
    runs-on: ubuntu-latest
    needs: [construir, probar, desplegar]  # DEPENDENCIAS mÃºltiples
    
    # CONDICIONAL: SIEMPRE se ejecuta, incluso si otros fallan
    if: always()
    
    steps:
      - name: Mostrar resultados
        run: |
          echo "ğŸ“Š RESUMEN DE EJECUCIÃ“N"
          echo "======================="
          echo "ğŸ—ï¸  Construir: ${{ needs.construir.result }}"
          echo "ğŸ§ª Probar: ${{ needs.probar.result }}"
          echo "ğŸš€ Desplegar: ${{ needs.desplegar.result || 'No ejecutado (condicional)' }}"
          echo ""
          
          # CONDICIONAL basado en resultados
          if [[ "${{ needs.construir.result }}" == "success" ]]; then
            echo "âœ… Â¡ConstrucciÃ³n exitosa!"
          else
            echo "âŒ Hubo problemas en la construcciÃ³n"
          fi