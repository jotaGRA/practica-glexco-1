name: ğŸ“ Ejemplo BÃ¡sico de Jobs y Steps

on:
  workflow_dispatch:  # Se ejecuta manualmente desde la interfaz

jobs:
  # JOB 1: PreparaciÃ³n - Corre primero
  preparacion:
    name: ğŸ“¦ Preparar ambiente
    runs-on: ubuntu-latest
    
    steps:
      # STEP 1: Descargar el cÃ³digo
      - name: Descargar cÃ³digo del repositorio
        uses: actions/checkout@v4
      
      # STEP 2: Crear un archivo de prueba
      - name: Crear archivo de configuraciÃ³n
        id: crear-archivo
        run: |
          echo "PROYECTO=MiProyecto" > config.txt
          echo "VERSION=1.0.0" >> config.txt
          echo "FECHA=$(date)" >> config.txt
          echo "âœ… Archivo config.txt creado"
          ls -la
      
      # STEP 3: Guardar informaciÃ³n para el siguiente job
      - name: Generar salida (output)
        id: generar-output
        run: |
          echo "nombre=mi-aplicacion" >> $GITHUB_OUTPUT
          echo "estado=preparado" >> $GITHUB_OUTPUT
      
      # STEP 4: Mostrar informaciÃ³n del entorno
      - name: Mostrar detalles del runner
        run: |
          echo "ğŸƒ Runner: ${{ runner.os }}"
          echo "ğŸ“ Directorio: ${{ runner.workspace }}"
          echo "ğŸ”§ GitHub SHA: ${{ github.sha }}"

  # JOB 2: Pruebas - Depende del job de preparaciÃ³n
  pruebas:
    name: ğŸ§ª Ejecutar pruebas
    runs-on: ubuntu-latest
    needs: preparacion  # Espera a que 'preparacion' termine
    
    steps:
      # STEP 1: Verificar el archivo del job anterior
      - name: Leer archivo creado
        run: |
          echo "ğŸ“– Contenido de config.txt:"
          cat config.txt
          
          if [ ! -f "config.txt" ]; then
            echo "âŒ ERROR: No se encontrÃ³ config.txt"
            exit 1
          fi
      
      # STEP 2: Simular pruebas unitarias
      - name: Ejecutar pruebas simples
        run: |
          echo "ğŸ§ª Ejecutando pruebas..."
          echo "1. Prueba de conexiÃ³n... âœ…"
          echo "2. ValidaciÃ³n de datos... âœ…"
          echo "3. Prueba de rendimiento... âœ…"
          echo "ğŸ‰ Â¡Todas las pruebas pasaron!"
      
      # STEP 3: Paso que puede fallar (para demostraciÃ³n)
      - name: Prueba condicional (puede fallar)
        id: prueba-condicional
        continue-on-error: true  # ContinÃºa aunque falle
        run: |
          echo "ğŸ” Ejecutando prueba opcional..."
          # Simular una falla aleatoria (1 de 3 veces falla)
          if [ $((RANDOM % 3)) -eq 0 ]; then
            echo "âš ï¸ Esta prueba fallÃ³ (simulado)"
            exit 1
          else
            echo "âœ… Prueba opcional exitosa"
          fi
      
      # STEP 4: Mostrar resultado del paso anterior
      - name: Mostrar resultado de pruebas
        run: |
          echo "ğŸ“Š Resultado de 'prueba-condicional': ${{ steps.prueba-condicional.outcome }}"
          if [ "${{ steps.prueba-condicional.outcome }}" = "failure" ]; then
            echo "âš ï¸ Una prueba fallÃ³, pero el job continÃºa"
          fi

  # JOB 3: Resumen - Siempre se ejecuta, incluso si otros fallan
  resumen:
    name: ğŸ“‹ Mostrar resumen
    runs-on: ubuntu-latest
    needs: [preparacion, pruebas]  # Necesita ambos jobs anteriores
    if: always()  # Â¡Siempre se ejecuta!
    
    steps:
      # STEP 1: Recolectar informaciÃ³n de los jobs anteriores
      - name: Recolectar resultados
        run: |
          echo "ğŸ“Š RESUMEN DEL WORKFLOW"
          echo "========================"
          echo "ğŸ“¦ PreparaciÃ³n: ${{ needs.preparacion.result }}"
          echo "ğŸ§ª Pruebas: ${{ needs.pruebas.result }}"
          echo "â° Hora: $(date)"
          echo "ğŸ‘¤ Ejecutado por: ${{ github.actor }}"
          
          if [[ "${{ needs.pruebas.result }}" == "success" ]]; then
            echo "ğŸ‰ Â¡Todos los jobs principales fueron exitosos!"
          else
            echo "âš ï¸ Algunos jobs tuvieron problemas"
          fi
      
      # STEP 2: Paso que solo se ejecuta si todo fue bien
      - name: Mensaje de Ã©xito
        if: success()
        run: echo "âœ… Â¡Workflow completado exitosamente!"
      
      # STEP 3: Paso que solo se ejecuta si hubo fallas
      - name: Mensaje de advertencia
        if: failure()
        run: echo "âš ï¸ El workflow completÃ³ con algunos errores"
      
      # STEP 4: Paso final que siempre se ejecuta
      - name: Limpieza final
        run: echo "ğŸ§¹ Finalizando ejecuciÃ³n..."